# Two-Stage Op-Amp Configuration

netlist: ../envs/netlist_template.sp

# Device parameter bounds [min, max] in SI units
parameters:
  W1:  # NMOS input pair width
    min: 1.0e-6
    max: 100.0e-6
    default: 50.0e-6      # midpoint of range (index 49 / 100 levels)
    step: 1.0e-6          # 1µm increments → 100 levels
  L1:  # NMOS input pair length
    min: 0.18e-6
    max: 5.0e-6
    default: 2.5e-6       # midpoint of range (index ~23 / 49 levels)
    step: 0.1e-6           # 100nm increments → 49 levels
  W3:  # PMOS load width
    min: 1.0e-6
    max: 200.0e-6
    default: 100.0e-6     # midpoint of range (index 99 / 200 levels)
    step: 1.0e-6           # 1µm increments → 200 levels
  L3:  # PMOS load length
    min: 0.18e-6
    max: 5.0e-6
    default: 2.5e-6       # midpoint of range
    step: 0.1e-6           # 100nm increments → 49 levels
  W5:  # Tail current source width
    min: 1.0e-6
    max: 100.0e-6
    default: 50.0e-6      # midpoint of range
    step: 1.0e-6           # 1µm increments → 100 levels
  L5:  # Tail current source length
    min: 0.18e-6
    max: 5.0e-6
    default: 2.5e-6       # midpoint of range
    step: 0.1e-6           # 100nm increments → 49 levels
  W7:  # Second stage NMOS width
    min: 1.0e-6
    max: 200.0e-6
    default: 100.0e-6     # midpoint of range
    step: 1.0e-6           # 1µm increments → 200 levels
  L7:  # Second stage NMOS length
    min: 0.18e-6
    max: 5.0e-6
    default: 2.5e-6       # midpoint of range
    step: 0.1e-6           # 100nm increments → 49 levels
  Cc:  # Compensation capacitor
    min: 0.1e-12
    max: 10.0e-12
    default: 5.0e-12      # midpoint of range (index 49 / 99 levels)
    step: 0.1e-12          # 0.1pF increments → 99 levels
  Ib:  # Bias current
    min: 1.0e-6
    max: 100.0e-6
    default: 50.0e-6      # midpoint of range (index 49 / 100 levels)
    step: 1.0e-6           # 1µA increments → 100 levels

# Physical constraints (evaluated on SI values)
constraints:
  - "W1 >= 2 * L1"      # Input pair W/L >= 2
  - "W3 >= 2 * L3"      # PMOS load W/L >= 2
  - "W5 >= 2 * L5"      # Tail current source W/L >= 2
  - "W7 >= 2 * L7"      # Second stage W/L >= 2

# Target specifications
target_specs:
  gain_db:
    value: 60.0
    tolerance: 2.0
    range: [58.0, 63.0]   # tight range around nominal
    direction: max        # only penalize if gain < target
  ugbw:
    value: 50.0e6
    tolerance: 5.0e6
    range: [45.0e6, 55.0e6]  # tight range around nominal
    direction: max        # only penalize if UGBW < target
  phase_margin:
    value: 60.0
    tolerance: 5.0
    range: [58.0, 65.0]   # tight range around nominal
    direction: max        # only penalize if PM < target
  power:
    value: 1.0e-3
    tolerance: 0.1e-3
    range: [0.8e-3, 1.2e-3]  # tight range around nominal
    direction: min        # only penalize if power > target

# Environment settings
env:
  max_steps: 100
  sim_timeout: 30
  randomize_start: false

# ppo hyperparameters
ppo:
  learning_rate: 3.0e-4
  n_steps: 256
  batch_size: 32
  n_epochs: 10
  gamma: 0.99
  total_timesteps: 100000
